<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../../css/estilos.css" type="text/css">


<body>
    <script>


        function cerrarAlerta() {
            const texto = document.getElementById("alertas");
            texto.style.display = "none"; // Oculta el div
        }

        function mostrarAlerta(mensaje) {
            const alerta = document.getElementById("alertas");
            alerta.style.display = "block"; // Muestra el div
            alerta.innerHTML = `
      ${mensaje} 
      </br> 
    <button onclick="cerrarAlerta()" style="background-color: #991717 ;">Cerrar</button>

  `;
        }




        function login() {
            event.preventDefault(); // Prevenir el comportamiento predeterminado del formulario

            // Obtener los valores del formulario
            const user = document.getElementById('user').value;
            const pass = document.getElementById('pass').value;

            // Crear el objeto XMLHttpRequest
            const obj = new XMLHttpRequest();

            // Definir la función de callback para manejar la respuesta
            obj.onload = function () {
                try {
                    // Parsear la respuesta como JSON
                    const result = JSON.parse(this.responseText);

                    console.log("Respuesta JSON:", result);

                    if (result.status === "success") {
                        const respuesta = result.data.respuesta;
                        const usuario = result.data.usuario;

                        console.log("Respuesta:", respuesta);
                        console.log("Usuario:", usuario);

                        if (respuesta) {

                            // window.location.href = "/html/admin/adminDashboard.html";
                            mostrarAlerta(`Bienvenido, ${usuario}`);

                            //   document.getElementById("alertas").innerHTML = `<p style="color: red;">${result.message}</p>`;

                            const obj2 = new XMLHttpRequest(); // Crear una instancia de XMLHttpRequest
                            obj2.open("GET", './adminDashboard.html', true); // Configurar la solicitud (GET al archivo)

                            obj2.onload = function () {
                                if (obj2.status === 200) {
                                    // Inyectar el contenido del archivo en el elemento destino
                                    document.getElementById('visualGeneral').innerHTML = obj2.responseText;

                                    console.log(obj2.responseText)
                                } else {
                                    console.error("Error al cargar el archivo HTML:", obj2.status);
                                    document.getElementById(elementoDestino).innerHTML = `<p>Error al cargar contenido.</p>`;
                                }
                            };

                            obj2.onerror = function () {
                                console.error("Error de conexión al cargar el archivo HTML.");
                            };

                            obj2.send(); // Enviar la solicitud
                        
        

                    }
                } else {
                    // Mostrar mensaje de error
                    document.getElementById("alertas").innerHTML = `<p style="color: red;">${result.message}</p>`;


                    mostrarAlerta(`<h3>${result.message}</h3>`)


                }
            } catch (error) {
                console.error("Error al procesar la respuesta:", error);
                document.getElementById("alertas").innerHTML = `<p style="color: red;">Error en el servidor. Intenta nuevamente.</p>`;
            }
        };

        // Configurar la solicitud POST
        obj.open("POST", "../../php/consultas/login.php", true);

        // Establecer el encabezado para enviar datos como formulario
        obj.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

        // Enviar los datos en el cuerpo de la solicitud
        obj.send("user=" + encodeURIComponent(user) + "&pass=" + encodeURIComponent(pass));
        }



        // <!--action="../../php/consultas/login.php" -->

    </script>
    <div class="" id="visualGeneral">
        <form>
            <input type="text" placeholder="Ingrese el usuario" id="user" name="user">
            <input type="password" placeholder="Ingrese la contreseña" id="pass" name="pass">
            <button onclick="login(event)">Iniciar Sesion</button>
        </form>

        <div class="" id="visual">


        </div>

        <div class="alertas" id="alertas">


        </div>
</body>

</html>